<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf=8">
    <meta name="viewport" content="initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no">
    <title>五子棋AI</title>
    <style>
      body {
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <div id="gameboard"></div>
    <script src="convnet.js"></script>
    <script src="deeplearn.js"></script>
    <script src="deeplearn-model.js"></script>
    <script src="convnet-model.js"></script>
    <script src="map-model.js"></script>
    <script src="game.js"></script>
    <script src="player-ai.js"></script>
    <script src="player-ui.js"></script>
    <script>
      const model = new ConvnetModel();
      // const model = new MapModel();
      // const model = new DeeplearnModel();
      try {
        model.fromJSON(JSON.parse(localStorage.goBangCore));
      } catch (err) {}
      (async () => {
        let epoch = 0;
        const ai = [
          new PlayerAI(model),
          new PlayerAI(model),
        ];
        let wins = null;
        let prevTime = Date.now();
        while (true) {
          if (!wins) {
            wins = {};
            ai[0].randomness = (Math.random() * 0.4 + 0.06).toFixed(2) - 0;
            ai[1].randomness = 0.05;
            wins[ai[0].randomness] = 0;
            wins[ai[1].randomness] = 0;
          }
          if (Math.random() < 0.5) {
            ([ai[0], ai[1]] = [ai[1], ai[0]]);
          }
          const game = new Game(ai[0], ai[1]);
          await game.play();
          if (game.win) {
            wins[ai[game.win - 1].randomness] += 1;
          }
          epoch++;
          if (epoch % 5 == 0) {
            displayUI(document.getElementById('gameboard'), game);
            await new Promise(r => setTimeout(r, 1));
          }
          if (epoch % 100 === 0) {
            localStorage.goBangCore = JSON.stringify(model.toJSON());
            console.log('epoch:', epoch, 'avgError:', ai[0].avgError().toFixed(5), wins, Date.now() - prevTime);
            prevTime = Date.now();
            wins = null;
          }
        }
      })();
    </script>
  </body>
</html>

