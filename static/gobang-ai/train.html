<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf=8">
    <meta name="viewport" content="initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no">
    <title>五子棋AI</title>
    <style>
      body {
        break-word: break-all;
      }
    </style>
  </head>
  <body>
    <div id="gameboard"></div>
    <script src="game.js"></script>
    <script src="player-ai.js"></script>
    <script src="player-ui.js"></script>
    <script>
      const HORDE_SIZE = 10;
      let horde = [];
      try {
        horde.push(JSON.parse(localStorage.goBangCore));
      } catch (err) {}
      horde.push(createRandomCore());
      const ui = new PlayerUI(document.getElementById('gameboard'));
      (async () => {
        let epoch = 0;
        let maxRounds = 30;
        let champ = horde[0];
        champ.score = 0;
        while (true) {
          while (horde.length < HORDE_SIZE) {
            const pa = Math.floor(Math.random() * horde.length);
            const pb = Math.floor(Math.random() * horde.length);
            horde.push(inheritCore(crossCore(horde[pa], horde[pb])))
          }
          await new Promise(r => setTimeout(r, 5));
          const former = new PlayerAI(champ);
          const challenge = async (challenger, side) => {
            side -= 1;
            const players = [former, former];
            players[side] = challenger;
            const game = new Game(players, true);
            challenger.game = game;
            game.remainRound = maxRounds;
            return new Promise(r => {
              game.onEnd = (result, score) => {
                r(score[side]);
              };
              game.play();
            });
          };
          for (let i = 0; i < horde.length; i++) {
            const orc = horde[i];
            const challenger = new PlayerAI(orc);
            orc.score = Math.min(await challenge(challenger, BLACK), await challenge(challenger, WHITE));
            orc.game = challenger.game;
            await new Promise(r => setTimeout(r, 5));
          }
          epoch++;
          ui.end(horde[HORDE_SIZE - 1].game);
          console.log('epoch', epoch, horde.map(v => v.score), maxRounds);
          horde.sort((a, b) => b.score - a.score);
          if (horde[0].score > champ.score) {
            champ = horde[0].slice(0);
            champ.score = horde[0].score;
            localStorage.goBangCore = JSON.stringify(champ);
            console.log('new champion', champ.score);
          }
          horde = horde.slice(0, Math.ceil(horde.length / 2));
        }
      })();
    </script>
  </body>
</html>

